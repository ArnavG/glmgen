R_PKG_VERSION=0.0.2
CC=gcc

R_DIR=R_pkg
C_DIR=c_lib/glmgen
CFLAGS=-O3 -Wall -Wextra -ansi -std=c89 -pedantic
CFLAGS2=-O3
OBJ=obj/*.o
IDIR=../include/

all:
	cd ${R_DIR}
	sudo R CMD build glmgen
	sudo R CMD INSTALL glmgen_${R_PKG_VERSION}.tar.gz
	sudo R CMD CHECK --as-cran glmgen_${R_PKG_VERSION}.tar.gz
	sudo rm -rf glmgen.Rcheck
	sudo rm glmgen_${R_PKG_VERSION}.tar.gz
	cd ..

	cp R_pkg/glmgen/src/tf/*.c c_lib/glmgen/src/tf/
	cp R_pkg/glmgen/src/utils/*.c c_lib/glmgen/src/utils/
	cp R_pkg/glmgen/inst/include/*.h c_lib/glmgen/include

	cd ${C_LIB};
	mkdir -p lib
	mkdir -p obj
	cd obj
	${CC} ${CLFAGS2} -c -fPIC ../src/csparse/*.c -I${IDIR}
	${CC} ${CFLAGS}  -c -fPIC ../src/utils/*.c -I${IDIR}
	${CC} ${CFLAGS}  -c -fPIC ../src/tf/*.c -I${IDIR}
	cd ..
	${CC} -shared -o lib/libglmgen.so ${OBJ}
	rm -rf lib
	rm -rf obj
	cd ../..
